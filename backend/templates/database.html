{% extends 'base.html' %}
{% block title %}Database Â· SustainAlign Admin{% endblock %}
{% block content %}
<div class="space-y-6">
  <div class="rounded-xl border border-slate-200/20 bg-white/5 p-6">
    <h1 class="text-xl font-bold text-emerald-400 mb-1">Database Explorer</h1>
    <p class="text-slate-400 text-sm">Browse tables from SQLAlchemy metadata. Click a table to view up to 25 rows.</p>
  </div>

  {% if tables %}
  <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
    <!-- Sidebar nav -->
    <aside class="md:col-span-1">
      <nav class="rounded-xl border border-slate-200/20 bg-white/5 divide-y divide-slate-200/10 sticky top-6" aria-label="Tables">
        {% for t in tables %}
        <a href="#table-{{ t.name }}"
           data-target="table-{{ t.name }}"
           class="flex items-center justify-between px-4 py-3 text-sm hover:bg-white/10 transition-colors group table-link {% if loop.first %}is-active{% endif %}">
          <span class="text-slate-200 group-[.is-active]:text-emerald-300 font-medium">{{ t.name }}</span>
          <span class="text-xs text-slate-400 group-[.is-active]:text-emerald-300">{{ t.count if t.count is not none else 'n/a' }}</span>
        </a>
        {% endfor %}
      </nav>
    </aside>

    <!-- Content -->
    <section class="md:col-span-3 space-y-6">
      {% for t in tables %}
      <div id="table-{{ t.name }}" class="rounded-xl border border-slate-200/20 bg-white/5 p-6 table-panel {% if not loop.first %}hidden{% endif %}">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-lg font-semibold text-slate-100">{{ t.name }}</h3>
          <span class="text-sm text-slate-400">{{ t.count if t.count is not none else 'n/a' }} rows</span>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead>
              <tr class="text-left">
                {% for col in t.columns %}
                <th class="p-2 whitespace-nowrap text-slate-300">{{ col }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for row in t.rows %}
              <tr class="odd:bg-white/5">
                {% for col in t.columns %}
                <td class="p-2 whitespace-nowrap text-slate-200">{{ row[col] }}</td>
                {% endfor %}
              </tr>
              {% else %}
              <tr>
                <td class="p-2 text-slate-400" colspan="{{ t.columns|length }}">No data.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      {% endfor %}
    </section>
  </div>
  {% else %}
  <div class="bg-white rounded-xl shadow p-6 border border-slate-200">
    <p class="text-slate-600">No tables found in metadata.</p>
  </div>
  {% endif %}
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const links = Array.from(document.querySelectorAll('.table-link'))
    const panels = Array.from(document.querySelectorAll('.table-panel'))

    function activate(targetId) {
      panels.forEach(p => p.classList.add('hidden'))
      links.forEach(l => l.classList.remove('is-active'))
      const target = document.getElementById(targetId)
      if (target) target.classList.remove('hidden')
      const activeLink = links.find(l => l.dataset.target === targetId)
      if (activeLink) activeLink.classList.add('is-active')
    }

    links.forEach(link => {
      link.addEventListener('click', function (e) {
        e.preventDefault()
        activate(this.dataset.target)
        history.replaceState(null, '', '#' + this.dataset.target)
      })
    })

    // Deep-link support
    if (location.hash) {
      const tid = location.hash.replace('#', '')
      if (document.getElementById(tid)) activate(tid)
    }
  })
  </script>
{% endblock %}


