# IBM WatsonX Orchestrate Integration for SustainAlign

Complete integration of SustainAlign's AI agents and tools with IBM WatsonX Orchestrate for advanced CSR project analysis, matching, evaluation, and decision support.

## ‚úÖ **CURRENT STATUS: FULLY WORKING** 

**All 4 SustainAlign agents and 4 tools are successfully deployed and running!**

- üéØ **Web Interface**: http://localhost:3000/chat-lite
- ü§ñ **4 AI Agents**: CSR Matching, Project Evaluation, Decision Support, Impact Assessment
- üõ†Ô∏è **4 Analysis Tools**: Project Analyzer, Impact Calculator, Risk Assessor, Budget Optimizer
- üöÄ **Ready to Use**: Chat with agents through the web interface

## üèóÔ∏è Architecture Overview

### ü§ñ AI Agents
- **CSR_Matching_Agent**: Analyzes company CSR objectives and matches them with NGO projects
- **Project_Evaluation_Agent**: Evaluates project feasibility, impact potential, and sustainability
- **Decision_Support_Agent**: Provides strategic decision support for CSR investments and portfolio optimization
- **Impact_Assessment_Agent**: Assesses social and environmental impact of CSR projects

### üõ†Ô∏è Analysis Tools
- **project_analyzer_function**: Analyzes projects for alignment, feasibility, and impact potential
- **impact_calculator_function**: Calculates comprehensive social and environmental impact metrics
- **risk_assessor_function**: Assesses project risks across multiple dimensions with mitigation strategies
- **budget_optimizer_function**: Optimizes budget allocation across multiple projects based on various criteria

## üìÅ Directory Structure

```
backend/ibm_watson/
‚îú‚îÄ‚îÄ agents/                          # Agent YAML specifications
‚îÇ   ‚îú‚îÄ‚îÄ csr_matching_agent.yaml
‚îÇ   ‚îú‚îÄ‚îÄ project_evaluation_agent.yaml
‚îÇ   ‚îú‚îÄ‚îÄ decision_support_agent.yaml
‚îÇ   ‚îî‚îÄ‚îÄ impact_assessment_agent.yaml
‚îú‚îÄ‚îÄ tools/                          # Tool implementations and YAML specs
‚îÇ   ‚îú‚îÄ‚îÄ project_analyzer.py
‚îÇ   ‚îú‚îÄ‚îÄ project_analyzer_tool.yaml
‚îÇ   ‚îú‚îÄ‚îÄ impact_calculator.py
‚îÇ   ‚îú‚îÄ‚îÄ impact_calculator_tool.yaml
‚îÇ   ‚îú‚îÄ‚îÄ risk_assessor.py
‚îÇ   ‚îú‚îÄ‚îÄ risk_assessor_tool.yaml
‚îÇ   ‚îú‚îÄ‚îÄ budget_optimizer.py
‚îÇ   ‚îî‚îÄ‚îÄ budget_optimizer_tool.yaml
‚îú‚îÄ‚îÄ deploy_agents.py                # Deployment script
‚îú‚îÄ‚îÄ test_integration.py             # Integration testing script
‚îú‚îÄ‚îÄ demo_integration.py             # Live demonstration script
‚îî‚îÄ‚îÄ README.md                       # This file
```

## üöÄ Complete Setup Guide

### üìã Prerequisites Checklist

Before starting, ensure you have:
- [ ] Python 3.8+ installed
- [ ] IBM WatsonX account and credentials
- [ ] Docker Desktop running (for local development)
- [ ] Terminal/Command Prompt access

### Step 1: Prerequisites

1. **Install IBM WatsonX Orchestrate Developer Edition**
   ```bash
   # Install the ADK
   pip install --upgrade ibm-watsonx-orchestrate
   
   # Verify installation
   orchestrate --version
   ```

2. **Get IBM WatsonX Credentials**
   - Sign up for IBM WatsonX at https://watsonx.ai
   - Get your API key and service URL
   - Note your entitlement key for myibm source

### Step 2: Environment Setup

1. **Create Environment File**
   ```bash
   # Create .env file in backend directory
   # Use PowerShell on Windows:
   @"
   # IBM WatsonX Orchestrate Configuration
   # Generated by setup_environment.py
   
   WO_DEVELOPER_EDITION_SOURCE=orchestrate
   WO_API_KEY=your_api_key_here
   WO_INSTANCE=https://api.ap-south-1.dl.watson-orchestrate.ibm.com/instances/your-instance-id
   WATSON_API_KEY=your_api_key_here
   WATSON_SERVICE_URL=https://api.ap-south-1.dl.watson-orchestrate.ibm.com
   "@ | Out-File -FilePath .env -Encoding ASCII
   
   # OR for watsonx.ai integration (alternative)
   # WO_DEVELOPER_EDITION_SOURCE=myibm
   # WO_ENTITLEMENT_KEY=your_entitlement_key_here
   # WATSONX_APIKEY=your_watsonx_api_key_here
   # WATSONX_SPACE_ID=your_space_id_here
   ```

2. **Start WatsonX Orchestrate Server**
   ```bash
   # Start the orchestrate server (this will take 10-15 minutes first time)
   orchestrate server start -e .env
   
   # Wait for server to fully initialize, then activate local environment
   orchestrate env activate local
   
   # Optional: Start the copilot server in a new terminal
   orchestrate copilot start -e .env
   ```

3. **Verify Server is Running**
   ```bash
   # Check server status
   orchestrate health
   
   # Check environment status
   orchestrate env status
   ```

### Step 3: Deploy Agents and Tools

1. **Navigate to IBM Watson Directory**
   ```bash
   cd backend/ibm_watson
   ```

2. **Deploy Tools First (Required)**
   ```bash
   # Deploy tools using Python files (not YAML)
   orchestrate tools import -k python -f tools/project_analyzer.py
   orchestrate tools import -k python -f tools/impact_calculator.py
   orchestrate tools import -k python -f tools/risk_assessor.py
   orchestrate tools import -k python -f tools/budget_optimizer.py
   ```

3. **Deploy Agents**
   ```bash
   # Deploy agents using YAML files
   orchestrate agents import -f agents/csr_matching_agent.yaml
   orchestrate agents import -f agents/project_evaluation_agent.yaml
   orchestrate agents import -f agents/decision_support_agent.yaml
   orchestrate agents import -f agents/impact_assessment_agent.yaml
   ```

4. **Verify Deployment**
   ```bash
   # List deployed agents
   orchestrate agents list
   
   # List deployed tools
   orchestrate tools list
   
   # Check specific agent status
   orchestrate agents status CSR_Matching_Agent
   ```

### Step 4: Test Integration

1. **Run Integration Tests**
   ```bash
   # Test all agents and tools
   python test_integration.py
   ```

2. **Run Live Demo**
   ```bash
   # See agents and tools in action
   python demo_integration.py
   ```

### Step 5: Interact with Agents

1. **Start Chat Interface**
   ```bash
   # Start the chat UI service
   orchestrate chat start
   
   # This will open the web interface at http://localhost:3000/chat-lite
   ```

2. **Web Interface Usage**
   - Open your browser and go to `http://localhost:3000/chat-lite`
   - Select an agent from the dropdown (CSR_Matching_Agent, Project_Evaluation_Agent, etc.)
   - Start chatting with questions like:
     - "Analyze this project for alignment with our company objectives"
     - "Help me evaluate the feasibility of this CSR project"
     - "Assess the social impact of our community development initiative"

## üîß Manual Deployment (Alternative)

If you prefer to deploy manually instead of using the automated script:

### Deploy Tools First
```bash
# Deploy individual tools using Python files (not YAML)
orchestrate tools import -k python -f tools/project_analyzer.py
orchestrate tools import -k python -f tools/impact_calculator.py
orchestrate tools import -k python -f tools/risk_assessor.py
orchestrate tools import -k python -f tools/budget_optimizer.py
```

### Deploy Agents
```bash
# Deploy individual agents
orchestrate agents import -f agents/csr_matching_agent.yaml
orchestrate agents import -f agents/project_evaluation_agent.yaml
orchestrate agents import -f agents/decision_support_agent.yaml
orchestrate agents import -f agents/impact_assessment_agent.yaml
```

## üß™ Testing Commands

### Test Individual Tools
```bash
# Test project analyzer tool directly
cd backend/ibm_watson
python -c "
from tools.project_analyzer import project_analyzer_function
result = project_analyzer_function(
    project_data={'name': 'Test Project', 'budget': 10000, 'sdg_focus': [4]},
    company_profile={'sdg_priorities': [4], 'available_budget': 50000},
    analysis_type='alignment'
)
print(f'Alignment Score: {result[\"overall_score\"]}')
"
```

### Test Agent Availability
```bash
# Check if agents are properly deployed
orchestrate agents list --verbose

# Check specific agent details
orchestrate agents describe CSR_Matching_Agent

# Check agent status
orchestrate agents status CSR_Matching_Agent
```

### Test Tool Availability
```bash
# Check if tools are properly deployed
orchestrate tools list --verbose

# Check specific tool details
orchestrate tools describe project_analyzer_function

# Check tool status
orchestrate tools status project_analyzer_function
```

## üéØ Usage Examples

### 1. CSR Matching Agent
```
User: "Analyze this rural education project for alignment with our company objectives"
Agent: Uses project_analyzer_function and impact_calculator_function to provide comprehensive analysis
```

### 2. Project Evaluation Agent
```
User: "Evaluate the feasibility of this clean water project"
Agent: Uses project_analyzer_function and risk_assessor_function to assess feasibility and risks
```

### 3. Decision Support Agent
```
User: "Help me optimize our CSR budget allocation across these 5 projects"
Agent: Uses budget_optimizer_function and risk_assessor_function to provide optimization recommendations
```

### 4. Impact Assessment Agent
```
User: "Assess the social and environmental impact of this community development project"
Agent: Uses impact_calculator_function and project_analyzer_function to measure comprehensive impact
```

## üîç Troubleshooting

### Common Issues and Solutions

1. **"orchestrate command not found"**
   ```bash
   # Install IBM WatsonX Orchestrate ADK
   pip install --upgrade ibm-watsonx-orchestrate
   
   # Verify installation
   orchestrate --version
   ```

2. **"No active environment"**
   ```bash
   # Check environment status
   orchestrate env status
   
   # Activate local environment
   orchestrate env activate local
   
   # Or add new environment
   orchestrate env add -n sustainalign -u <your_service_url> --type <env_type>
   ```

3. **"Agent deployment failed"**
   ```bash
   # Check YAML syntax
   orchestrate agents validate agents/csr_matching_agent.yaml
   
   # Check tool dependencies
   orchestrate tools list
   
   # Deploy tools first, then agents
   python deploy_agents.py
   ```

4. **"Tool execution errors"**
   ```bash
   # Check tool logs
   orchestrate tools logs project_analyzer_function
   
   # Validate tool YAML (if using YAML files)
   orchestrate tools validate tools/project_analyzer_tool.yaml
   ```

5. **"Server not running"**
   ```bash
   # Start server
   orchestrate server start -e .env
   
   # Check server status
   orchestrate health
   
   # Check if ports are available
   netstat -an | grep :3000
   netstat -an | grep :4321
   ```

### Debug Commands

```bash
# Check all logs
orchestrate logs

# Check agent logs
orchestrate agents logs CSR_Matching_Agent

# Check tool logs
orchestrate tools logs project_analyzer_function

# Health check
orchestrate health

# Environment status
orchestrate env status

# Server status
orchestrate server status
```

## üìä Monitoring and Maintenance

### Regular Checks
```bash
# Daily health check
orchestrate health

# Check agent status
orchestrate agents list

# Check tool status
orchestrate tools list

# Monitor resource usage
orchestrate server status
```

### Restart Services
```bash
# Restart orchestrate server
orchestrate server stop
orchestrate server start -e .env

# Restart copilot server
orchestrate copilot stop
orchestrate copilot start -e .env
```

## üöÄ Production Deployment

### Environment Variables
```bash
# Production environment file
export WO_DEVELOPER_EDITION_SOURCE=myibm
export WO_ENTITLEMENT_KEY=your_production_entitlement_key
export WATSONX_APIKEY=your_production_api_key
export WATSONX_SPACE_ID=your_production_space_id
```

### Production Commands
```bash
# Deploy to production
orchestrate env add -n production -u <production_url> --type <env_type>
orchestrate env activate production
python deploy_agents.py
```

## üìà Performance Optimization

### Resource Management
```bash
# Monitor resource usage
orchestrate server status

# Check memory usage
ps aux | grep orchestrate

# Monitor disk usage
df -h
```

### Scaling
```bash
# Scale up resources in Docker Desktop
# Increase CPU and Memory allocation
# Restart orchestrate server
orchestrate server restart
```

## üîê Security Best Practices

1. **Environment Variables**
   - Never commit .env files to version control
   - Use strong, unique API keys
   - Rotate keys regularly

2. **Access Control**
   - Limit access to orchestrate server
   - Use VPN for remote access
   - Monitor access logs

3. **Data Privacy**
   - Sanitize all inputs
   - Log all interactions
   - Implement data retention policies

## üìû Support and Resources

### IBM Documentation
- [WatsonX Orchestrate Documentation](https://developer.watson-orchestrate.ibm.com/)
- [ADK Tutorial Repository](https://github.com/pdhoolia/wxo-adk-tutorial)
- [IBM Granite Models](https://www.ibm.com/products/watsonx-ai)

### Troubleshooting Resources
1. Check this README first
2. Review IBM documentation
3. Check project issues
4. Contact development team

## üéâ Success Indicators

You'll know the integration is working when:

‚úÖ `orchestrate agents list` shows all 4 agents
‚úÖ `orchestrate tools list` shows all 4 tools
‚úÖ `python test_integration.py` passes all tests
‚úÖ `python demo_integration.py` runs successfully
‚úÖ Web interface at http://localhost:3000/chat-lite works
‚úÖ Agents respond to questions in chat interface

## üìã Quick Reference

### Essential Commands
```bash
# Setup
pip install ibm-watsonx-orchestrate
orchestrate server start -e .env
orchestrate env activate local

# Deploy
cd backend/ibm_watson
python deploy_agents.py

# Test
python test_integration.py
python demo_integration.py

# Use
orchestrate chat start
# OR open http://localhost:3000/chat-lite
```

### Complete Command Reference

#### Environment Management
```bash
# Environment commands
orchestrate env add -n <name> -u <url> --type <type>    # Add new environment
orchestrate env activate <name>                         # Activate environment
orchestrate env status                                  # Check environment status
orchestrate env list                                    # List all environments
```

#### Agent Management
```bash
# Agent commands
orchestrate agents list                                 # List all agents
orchestrate agents list --verbose                       # Detailed agent list
orchestrate agents import -f <agent.yaml>               # Import agent
orchestrate agents describe <agent_name>                # Describe agent
orchestrate agents status <agent_name>                  # Check agent status
orchestrate agents logs <agent_name>                    # View agent logs
orchestrate agents validate <agent.yaml>                # Validate agent YAML
```

#### Tool Management
```bash
# Tool commands
orchestrate tools list                                  # List all tools
orchestrate tools list --verbose                        # Detailed tool list
orchestrate tools import -f <tool.yaml>                 # Import tool
orchestrate tools describe <tool_name>                  # Describe tool
orchestrate tools status <tool_name>                    # Check tool status
orchestrate tools logs <tool_name>                      # View tool logs
orchestrate tools validate <tool.yaml>                  # Validate tool YAML
```

#### Server Management
```bash
# Server commands
orchestrate server start -e .env                        # Start server
orchestrate server stop                                 # Stop server
orchestrate server restart                              # Restart server
orchestrate server status                               # Check server status
orchestrate health                                      # Health check
```

#### Chat and Interaction
```bash
# Chat commands
orchestrate chat start                                  # Start chat interface
orchestrate copilot start -e .env                       # Start copilot server
orchestrate copilot stop                                # Stop copilot server
```

#### Monitoring and Debugging
```bash
# Monitoring commands
orchestrate logs                                        # View all logs
orchestrate models                                      # List available models
orchestrate settings                                    # Configure settings
orchestrate evaluations                                 # Evaluate agent performance
```

### File Locations
- Agents: `backend/ibm_watson/agents/`
- Tools: `backend/ibm_watson/tools/`
- Scripts: `backend/ibm_watson/`
- Environment: `.env` (project root)

## üéØ Step-by-Step Walkthrough

### Quick Start (5 minutes)

1. **Install and Verify**
   ```bash
   pip install --upgrade ibm-watsonx-orchestrate
   orchestrate --version
   ```

2. **Create Environment File**
   ```bash
   # In backend directory (PowerShell on Windows)
   @"
   # IBM WatsonX Orchestrate Configuration
   WO_DEVELOPER_EDITION_SOURCE=orchestrate
   WO_API_KEY=your_api_key_here
   WO_INSTANCE=https://api.ap-south-1.dl.watson-orchestrate.ibm.com/instances/your-instance-id
   WATSON_API_KEY=your_api_key_here
   WATSON_SERVICE_URL=https://api.ap-south-1.dl.watson-orchestrate.ibm.com
   "@ | Out-File -FilePath .env -Encoding ASCII
   ```

3. **Start Services**
   ```bash
   orchestrate server start -e .env
   orchestrate env activate local
   ```

4. **Deploy Everything**
   ```bash
   cd backend/ibm_watson
   # Deploy tools first
   orchestrate tools import -k python -f tools/project_analyzer.py
   orchestrate tools import -k python -f tools/impact_calculator.py
   orchestrate tools import -k python -f tools/risk_assessor.py
   orchestrate tools import -k python -f tools/budget_optimizer.py
   # Deploy agents
   orchestrate agents import -f agents/csr_matching_agent.yaml
   orchestrate agents import -f agents/project_evaluation_agent.yaml
   orchestrate agents import -f agents/decision_support_agent.yaml
   orchestrate agents import -f agents/impact_assessment_agent.yaml
   ```

5. **Test and Use**
   ```bash
   orchestrate chat start
   # Open http://localhost:3000/chat-lite in browser
   ```

### Detailed Walkthrough (15 minutes)

#### Phase 1: Environment Setup (5 min)
```bash
# 1. Install ADK
pip install --upgrade ibm-watsonx-orchestrate

# 2. Verify installation
orchestrate --version

# 3. Create environment file (PowerShell on Windows)
@"
# IBM WatsonX Orchestrate Configuration
WO_DEVELOPER_EDITION_SOURCE=orchestrate
WO_API_KEY=your_api_key_here
WO_INSTANCE=https://api.ap-south-1.dl.watson-orchestrate.ibm.com/instances/your-instance-id
WATSON_API_KEY=your_api_key_here
WATSON_SERVICE_URL=https://api.ap-south-1.dl.watson-orchestrate.ibm.com
"@ | Out-File -FilePath .env -Encoding ASCII

# 4. Start orchestrate server
orchestrate server start -e .env

# 5. Start copilot server (optional)
orchestrate copilot start -e .env

# 6. Activate local environment
orchestrate env activate local

# 7. Verify everything is running
orchestrate health
orchestrate env status
```

#### Phase 2: Deploy Agents and Tools (5 min)
```bash
# 1. Navigate to IBM Watson directory
cd backend/ibm_watson

# 2. Deploy tools first (required)
orchestrate tools import -k python -f tools/project_analyzer.py
orchestrate tools import -k python -f tools/impact_calculator.py
orchestrate tools import -k python -f tools/risk_assessor.py
orchestrate tools import -k python -f tools/budget_optimizer.py

# 3. Deploy agents
orchestrate agents import -f agents/csr_matching_agent.yaml
orchestrate agents import -f agents/project_evaluation_agent.yaml
orchestrate agents import -f agents/decision_support_agent.yaml
orchestrate agents import -f agents/impact_assessment_agent.yaml

# 4. Verify deployment
orchestrate agents list
orchestrate tools list

# 5. Check specific agent status
orchestrate agents status CSR_Matching_Agent
```

#### Phase 3: Test and Validate (3 min)
```bash
# 1. Run integration tests
python test_integration.py

# 2. Run live demo
python demo_integration.py

# 3. Test individual tool
python -c "
from tools.project_analyzer import project_analyzer_function
result = project_analyzer_function(
    project_data={'name': 'Test', 'budget': 10000, 'sdg_focus': [4]},
    company_profile={'sdg_priorities': [4], 'available_budget': 50000},
    analysis_type='alignment'
)
print(f'Score: {result[\"overall_score\"]}')
"
```

#### Phase 4: Start Using (2 min)
```bash
# Start chat interface
orchestrate chat start

# This will automatically open the web interface at:
# http://localhost:3000/chat-lite
# Select an agent from the dropdown and start chatting!
```

### üéâ Success Verification

After completing the walkthrough, you should see:

‚úÖ **Server Running**: `orchestrate health` shows "healthy"
‚úÖ **Environment Active**: `orchestrate env status` shows "local" as active
‚úÖ **4 Agents Deployed**: `orchestrate agents list` shows all 4 SustainAlign agents
‚úÖ **4 Tools Deployed**: `orchestrate tools list` shows all 4 SustainAlign tools
‚úÖ **Tests Passing**: `python test_integration.py` completes successfully
‚úÖ **Chat Working**: `orchestrate chat start` opens interactive chat
‚úÖ **Web UI Accessible**: http://localhost:3000/chat-lite loads properly

---

This integration provides a powerful foundation for AI-driven CSR project analysis and decision support. The agents and tools work together to provide comprehensive insights that help organizations make informed CSR investment decisions.
